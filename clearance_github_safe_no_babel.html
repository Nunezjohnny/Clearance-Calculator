<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Clearance - Find Your Breathing Room</title>

  <!-- Tailwind (CDN) -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React 18 UMD (DEV builds show useful errors instead of a blank page) -->
  <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>

  <style>
    input[type="range"] { width: 100%; }
  </style>
</head>
<body class="bg-white">
  <div id="root">
    <div class="min-h-screen flex items-center justify-center text-gray-700">
      Loading Clearance‚Ä¶
    </div>
  </div>

  <script>
    // Show runtime errors on the page (so you don't just get a blank screen).
    (function () {
      const root = document.getElementById('root');
      window.addEventListener('error', function (e) {
        root.innerHTML =
          '<div class="min-h-screen p-6 bg-red-50 text-red-800">' +
          '<h1 class="text-2xl font-bold mb-2">Clearance failed to load</h1>' +
          '<p class="mb-2">Open DevTools ‚Üí Console for details. Here is the first error:</p>' +
          '<pre class="whitespace-pre-wrap bg-white p-4 rounded border border-red-200 text-sm">' +
          (e.message || e.error || 'Unknown error') +
          '</pre>' +
          '</div>';
      });
    })();
  </script>

  <script>
    const { useState } = React;
    const h = React.createElement;

    function cx() {
      return Array.prototype.slice.call(arguments).filter(Boolean).join(' ');
    }

    function fmt(n) {
      return new Intl.NumberFormat('en-US', { maximumFractionDigits: 0 }).format(n);
    }

    function p(v) {
      const s = String(v ?? '').replace(/,/g, '').trim();
      const n = parseFloat(s);
      return Number.isFinite(n) ? n : 0;
    }

    // Text input (NOT type="number") to avoid the "one digit at a time" bug in some environments.
    function MoneyInput(props) {
      const { label, value, onChange } = props;
      return h('div', null,
        h('label', { className: 'block text-sm font-semibold text-gray-700 mb-1' }, label),
        h('div', { className: 'relative' },
          h('span', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium' }, '$'),
          h('input', {
            type: 'text',
            inputMode: 'decimal',
            autoComplete: 'off',
            spellCheck: false,
            value: value,
            onChange: (e) => onChange(e.target.value),
            placeholder: '0',
            className: 'w-full pl-7 pr-3 py-2.5 border-2 border-gray-300 rounded-lg outline-none focus:border-purple-500'
          })
        )
      );
    }

    function MoneyInputAvg(props) {
      const { label, value, onChange, avg } = props;
      return h('div', null,
        h('label', { className: 'block text-sm font-semibold text-gray-700 mb-1' }, label),
        h('div', { className: 'flex gap-2' },
          h('div', { className: 'relative flex-1' },
            h('span', { className: 'absolute left-3 top-1/2 -translate-y-1/2 text-gray-500 font-medium' }, '$'),
            h('input', {
              type: 'text',
              inputMode: 'decimal',
              autoComplete: 'off',
              spellCheck: false,
              value: value,
              onChange: (e) => onChange(e.target.value),
              placeholder: '0',
              className: 'w-full pl-7 pr-3 py-2.5 border-2 border-gray-300 rounded-lg outline-none focus:border-purple-500'
            })
          ),
          h('button', {
            type: 'button',
            onClick: () => onChange(String(avg)),
            className: 'px-3 py-2.5 bg-purple-100 hover:bg-purple-200 text-purple-700 rounded-lg text-sm font-semibold'
          }, 'Avg')
        )
      );
    }

    function ReductionSlider(props) {
      const { label, emoji, current, value, setValue, committed, toggleCommit } = props;
      const savings = current - value;
      const pct = current > 0 ? ((savings / current) * 100).toFixed(0) : '0';

      return h('div', { className: 'bg-gray-50 p-4 rounded-lg' },
        h('div', { className: 'flex justify-between items-start mb-3' },
          h('div', { className: 'flex items-center gap-2' },
            h('span', { className: 'text-2xl' }, emoji),
            h('div', null,
              h('div', { className: 'font-semibold text-gray-900' }, label),
              h('div', { className: 'text-sm text-gray-600' }, `Currently: $${fmt(current)}/mo`)
            )
          ),
          savings > 0 ? h('button', {
            type: 'button',
            onClick: toggleCommit,
            className: cx(
              'px-3 py-1.5 rounded-lg text-sm font-semibold',
              committed ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            )
          }, committed ? '‚úì Committed' : 'Commit') : null
        ),

        h('input', {
          type: 'range',
          min: 0,
          max: current,
          step: 5,
          value: value,
          onChange: (e) => setValue(parseFloat(e.target.value)),
          className: 'h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-purple-600'
        }),

        h('div', { className: 'flex justify-between items-center mt-2' },
          h('span', { className: 'text-sm font-semibold text-gray-900' }, `New: $${fmt(value)}/mo`),
          savings > 0 ? h('span', { className: 'text-sm font-semibold text-green-600' },
            `Save $${fmt(savings)}/mo (${pct}% less)`
          ) : null
        )
      );
    }

    function AdditionSlider(props) {
      const { label, emoji, value, setValue, max, step, committed, toggleCommit } = props;

      return h('div', { className: 'bg-gray-50 p-4 rounded-lg' },
        h('div', { className: 'flex justify-between items-start mb-3' },
          h('div', { className: 'flex items-center gap-2' },
            h('span', { className: 'text-2xl' }, emoji),
            h('div', { className: 'font-semibold text-gray-900' }, label)
          ),
          value > 0 ? h('button', {
            type: 'button',
            onClick: toggleCommit,
            className: cx(
              'px-3 py-1.5 rounded-lg text-sm font-semibold',
              committed ? 'bg-green-500 text-white' : 'bg-gray-200 text-gray-700 hover:bg-gray-300'
            )
          }, committed ? '‚úì Committed' : 'Commit') : null
        ),

        h('input', {
          type: 'range',
          min: 0,
          max: max,
          step: step,
          value: value,
          onChange: (e) => setValue(parseFloat(e.target.value)),
          className: 'h-2 bg-gray-300 rounded-lg appearance-none cursor-pointer accent-purple-600'
        }),

        h('div', { className: 'flex justify-between items-center mt-2' },
          h('span', { className: 'text-sm font-semibold text-gray-900' }, `$${fmt(value)}/mo`),
          value > 0 ? h('span', { className: 'text-sm font-semibold text-green-600' }, `+$${fmt(value)}/mo extra`) : null
        )
      );
    }

    function App() {
      const [step, setStep] = useState(1);
      const [showAdv, setShowAdv] = useState(false);

      // Strings for inputs (most stable)
      const [income, setIncome] = useState('');
      const [freq, setFreq] = useState('monthly');

      const [rent, setRent] = useState('');
      const [util, setUtil] = useState('');
      const [debt, setDebt] = useState('');
      const [groc, setGroc] = useState('');
      const [gas, setGas] = useState('');
      const [subs, setSubs] = useState('');

      const [ins, setIns] = useState('');
      const [other, setOther] = useState('');
      const [eat, setEat] = useState('');
      const [shop, setShop] = useState('');
      const [ent, setEnt] = useState('');
      const [otherV, setOtherV] = useState('');

      const [newSubs, setNewSubs] = useState(null);
      const [newEat, setNewEat] = useState(null);
      const [newShop, setNewShop] = useState(null);
      const [newGas, setNewGas] = useState(null);
      const [newEnt, setNewEnt] = useState(null);

      const [fees, setFees] = useState(0);
      const [neg, setNeg] = useState(0);
      const [side, setSide] = useState(0);
      const [commits, setCommits] = useState([]);

      const monthInc =
        freq === 'biweekly' ? p(income) * 26 / 12 :
        freq === 'twice-monthly' ? p(income) * 2 :
        p(income);

      const fixed = p(rent) + p(util) + p(debt) + p(ins) + p(other);

      const cGas = p(gas),
            cGroc = p(groc),
            cSubs = p(subs),
            cEat  = p(eat),
            cShop = p(shop),
            cEnt  = p(ent),
            cOtherV = p(otherV);

      const variable = cGas + cGroc + cSubs + cEat + cShop + cEnt + cOtherV;
      const baseline = monthInc - fixed - variable;

      const active = [
        newSubs !== null && newSubs < cSubs,
        newEat !== null && newEat < cEat,
        newShop !== null && newShop < cShop,
        newGas !== null && newGas < cGas,
        newEnt !== null && newEnt < cEnt,
        fees > 0, neg > 0, side > 0
      ].filter(Boolean).length;

      const savings =
        (newSubs !== null ? cSubs - newSubs : 0) +
        (newEat !== null ? cEat - newEat : 0) +
        (newShop !== null ? cShop - newShop : 0) +
        (newGas !== null ? cGas - newGas : 0) +
        (newEnt !== null ? cEnt - newEnt : 0) +
        fees + neg;

      const newClear = baseline + savings + side;
      const improve = newClear - baseline;

      const complete = monthInc > 0 && (fixed > 0 || variable > 0);

      const reset = () => {
        setNewSubs(null); setNewEat(null); setNewShop(null); setNewGas(null); setNewEnt(null);
        setFees(0); setNeg(0); setSide(0); setCommits([]);
      };

      const toggle = (name) => {
        setCommits(commits.includes(name) ? commits.filter(c => c !== name) : commits.concat([name]));
      };

      // ---------- STEP 1 ----------
      if (step === 1) {
        return h('div', { className: 'min-h-screen bg-gradient-to-br from-purple-600 to-purple-800 p-4 md:p-8' },
          h('div', { className: 'max-w-4xl mx-auto' },
            h('div', { className: 'text-center mb-8 text-white' },
              h('h1', { className: 'text-5xl font-bold mb-2' }, 'Clearance'),
              h('p', { className: 'text-xl opacity-95 font-medium' }, "Let's see where you are right now")
            ),

            h('div', { className: 'bg-white rounded-2xl p-6 md:p-8 shadow-2xl' },

              // Pay
              h('div', { className: 'mb-8' },
                h('h2', { className: 'text-xl font-bold mb-2 text-gray-900 flex items-center gap-2' },
                  h('span', { className: 'text-purple-600' }, 'üíµ'),
                  'Take-Home Pay'
                ),
                h('p', { className: 'text-sm text-gray-600 mb-4' }, 'After taxes‚Äîwhat actually hits your account'),

                h('div', { className: 'flex gap-4 mb-4 flex-wrap' },
                  h('div', { className: 'flex-1 min-w-[200px]' },
                    h(MoneyInput, {
                      label: (freq === 'monthly'
                        ? 'Monthly Pay'
                        : freq === 'biweekly'
                          ? 'Per Paycheck (every 2 weeks)'
                          : 'Per Paycheck (twice a month)'),
                      value: income,
                      onChange: setIncome
                    })
                  ),
                  h('div', { className: 'min-w-[200px]' },
                    h('label', { className: 'block text-sm font-semibold text-gray-700 mb-1' }, 'Pay Frequency'),
                    h('select', {
                      value: freq,
                      onChange: (e) => setFreq(e.target.value),
                      className: 'w-full p-2.5 border-2 border-gray-300 rounded-lg bg-white'
                    },
                      h('option', { value: 'monthly' }, 'Monthly'),
                      h('option', { value: 'biweekly' }, 'Biweekly (every 2 weeks)'),
                      h('option', { value: 'twice-monthly' }, 'Twice a month')
                    )
                  )
                ),

                (freq !== 'monthly' && monthInc > 0)
                  ? h('div', { className: 'text-sm text-purple-600 bg-purple-50 p-3 rounded-lg' }, `‚âà $${fmt(monthInc)}/month`)
                  : null
              ),

              // Essentials
              h('div', { className: 'mb-8 pt-8 border-t-2 border-gray-200' },
                h('h2', { className: 'text-xl font-bold mb-2 text-gray-900' }, 'Essential Monthly Bills'),
                h('p', { className: 'text-sm text-gray-600 mb-4' }, "Use monthly estimates. If you're not sure, use Avg."),
                h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                  h(MoneyInput, { label: 'Rent/Mortgage', value: rent, onChange: setRent }),
                  h(MoneyInput, { label: 'Utilities', value: util, onChange: setUtil }),
                  h(MoneyInput, { label: 'Debt Minimums', value: debt, onChange: setDebt }),
                  h(MoneyInputAvg, { label: 'Groceries', value: groc, onChange: setGroc, avg: 400 }),
                  h(MoneyInputAvg, { label: 'Gas/Transportation', value: gas, onChange: setGas, avg: 150 }),
                  h(MoneyInputAvg, { label: 'Subscriptions (Optional)', value: subs, onChange: setSubs, avg: 50 })
                )
              ),

              // Advanced
              h('div', { className: 'mb-8 pt-8 border-t-2 border-gray-200' },
                h('button', {
                  type: 'button',
                  onClick: () => setShowAdv(!showAdv),
                  className: 'w-full flex items-center justify-between text-left mb-4 p-3 bg-gray-50 hover:bg-gray-100 rounded-lg'
                },
                  h('span', { className: 'text-lg font-bold text-gray-900' }, 'Advanced (Optional)'),
                  h('span', { className: 'text-gray-800' }, showAdv ? '‚ñ¥' : '‚ñæ')
                ),

                showAdv ? h(React.Fragment, null,
                  h('p', { className: 'text-sm text-gray-600 mb-4' }, 'Add these if they apply to you. Use monthly estimates.'),
                  h('div', { className: 'grid grid-cols-1 md:grid-cols-2 gap-4' },
                    h(MoneyInput, { label: 'Insurance', value: ins, onChange: setIns }),
                    h(MoneyInput, { label: 'Other Fixed Bills', value: other, onChange: setOther }),
                    h(MoneyInputAvg, { label: 'Eating Out/Delivery', value: eat, onChange: setEat, avg: 250 }),
                    h(MoneyInputAvg, { label: 'Shopping/Clothes', value: shop, onChange: setShop, avg: 100 }),
                    h(MoneyInputAvg, { label: 'Entertainment', value: ent, onChange: setEnt, avg: 80 }),
                    h(MoneyInput, { label: 'Other Spending', value: otherV, onChange: setOtherV })
                  )
                ) : null
              ),

              // Baseline card
              complete ? h('div', {
                className: cx(
                  'rounded-xl p-8 mb-6 text-white text-center',
                  baseline >= 0 ? 'bg-gradient-to-br from-purple-600 to-purple-800' : 'bg-gradient-to-br from-pink-500 to-red-500'
                )
              },
                h('div', { className: 'text-sm uppercase tracking-wider opacity-90 font-semibold mb-2' },
                  baseline >= 0 ? 'Safe-to-Spend (This Month)' : "You're Short By"
                ),
                h('div', { className: 'text-6xl font-bold mb-2' }, `$${fmt(Math.abs(baseline))}`),
                h('div', { className: 'text-base opacity-90 mb-4' },
                  baseline >= 0 ? 'Money left after all your current spending' : 'More going out than coming in'
                ),
                h('div', { className: 'text-sm opacity-80 bg-white bg-opacity-15 p-3 rounded-lg' },
                  `Income: $${fmt(monthInc)} ‚àí Fixed: $${fmt(fixed)} ‚àí Variable: $${fmt(variable)}`
                )
              ) : null,

              // Next button
              h('button', {
                type: 'button',
                onClick: () => setStep(2),
                disabled: !complete,
                className: cx(
                  'w-full p-4 rounded-xl text-lg font-bold flex items-center justify-center gap-2',
                  complete
                    ? 'bg-gradient-to-br from-purple-600 to-purple-800 text-white hover:shadow-lg cursor-pointer'
                    : 'bg-gray-200 text-gray-400 cursor-not-allowed'
                )
              }, 'Find Breathing Room', h('span', null, '‚Üí'))
            )
          )
        );
      }

      // ---------- STEP 2 ----------
      return h('div', { className: 'min-h-screen bg-gradient-to-br from-purple-600 to-purple-800 p-4 md:p-8' },
        h('div', { className: 'max-w-4xl mx-auto' },

          h('div', { className: 'text-center mb-8 text-white' },
            h('h1', { className: 'text-5xl font-bold mb-2' }, 'Clearance'),
            h('p', { className: 'text-xl opacity-95 font-medium' }, 'Try 1‚Äì2 changes to create breathing room')
          ),

          h('div', { className: 'bg-white rounded-2xl p-6 md:p-8 shadow-2xl mb-6' },

            h('div', {
              className: cx(
                'rounded-xl p-8 mb-8 text-white text-center',
                baseline >= 0 ? 'bg-gradient-to-br from-purple-600 to-purple-800' : 'bg-gradient-to-br from-pink-500 to-red-500'
              )
            },
              h('div', { className: 'text-sm uppercase tracking-wider opacity-90 font-semibold mb-2' },
                baseline >= 0 ? 'Current Safe-to-Spend' : 'Currently Short By'
              ),
              h('div', { className: 'text-6xl font-bold mb-2' }, `$${fmt(Math.abs(baseline))}`)
            ),

            h('div', { className: 'mb-8' },
              h('div', { className: 'flex justify-between items-center mb-2' },
                h('h2', { className: 'text-xl font-bold text-gray-900 flex items-center gap-2 m-0' }, '‚ö°', 'What-If Levers'),
                active > 0 ? h('button', {
                  type: 'button',
                  onClick: reset,
                  className: 'px-3 py-2 bg-gray-100 hover:bg-gray-200 rounded-lg text-sm font-semibold text-purple-600 flex items-center gap-1'
                }, '‚Ü∫ Reset') : null
              ),

              h('p', { className: 'text-sm text-gray-600 mb-2' }, "Pick 1‚Äì2 changes you'll actually try this week"),

              active > 2 ? h('div', { className: 'bg-yellow-100 border border-yellow-400 rounded-lg p-3 mb-4 text-sm text-yellow-900' },
                `‚ö†Ô∏è You picked ${active} changes. Try focusing on just 1‚Äì2 for better results.`
              ) : null,

              h('div', { className: 'flex flex-col gap-6 mt-4' },
                cSubs > 0 ? h(ReductionSlider, {
                  label: 'Subscriptions', emoji: 'üì±',
                  current: cSubs, value: (newSubs !== null ? newSubs : cSubs),
                  setValue: setNewSubs,
                  committed: commits.includes('subs'),
                  toggleCommit: () => toggle('subs')
                }) : null,

                cGas > 0 ? h(ReductionSlider, {
                  label: 'Gas/Transportation', emoji: 'üöó',
                  current: cGas, value: (newGas !== null ? newGas : cGas),
                  setValue: setNewGas,
                  committed: commits.includes('gas'),
                  toggleCommit: () => toggle('gas')
                }) : null,

                cEat > 0 ? h(ReductionSlider, {
                  label: 'Eating Out/Delivery', emoji: 'üçî',
                  current: cEat, value: (newEat !== null ? newEat : cEat),
                  setValue: setNewEat,
                  committed: commits.includes('eat'),
                  toggleCommit: () => toggle('eat')
                }) : null,

                cShop > 0 ? h(ReductionSlider, {
                  label: 'Shopping/Clothes', emoji: 'üõçÔ∏è',
                  current: cShop, value: (newShop !== null ? newShop : cShop),
                  setValue: setNewShop,
                  committed: commits.includes('shop'),
                  toggleCommit: () => toggle('shop')
                }) : null,

                cEnt > 0 ? h(ReductionSlider, {
                  label: 'Entertainment', emoji: 'üéÆ',
                  current: cEnt, value: (newEnt !== null ? newEnt : cEnt),
                  setValue: setNewEnt,
                  committed: commits.includes('ent'),
                  toggleCommit: () => toggle('ent')
                }) : null,

                h(AdditionSlider, {
                  label: 'Avoid Fees (overdraft, late payments)', emoji: 'üö´',
                  value: fees, setValue: setFees, max: 150, step: 5,
                  committed: commits.includes('fees'),
                  toggleCommit: () => toggle('fees')
                }),

                h(AdditionSlider, {
                  label: 'Negotiate Bills (phone, internet, insurance)', emoji: 'üìû',
                  value: neg, setValue: setNeg, max: 100, step: 5,
                  committed: commits.includes('neg'),
                  toggleCommit: () => toggle('neg')
                }),

                h(AdditionSlider, {
                  label: 'Add Side Income', emoji: 'üí∞',
                  value: side, setValue: setSide, max: 1000, step: 25,
                  committed: commits.includes('side'),
                  toggleCommit: () => toggle('side')
                })
              )
            ),

            improve > 0 ? h('div', { className: 'bg-gradient-to-br from-green-500 to-green-600 rounded-xl p-6 text-white mb-6' },
              h('div', { className: 'flex items-center gap-3 mb-3' },
                h('span', { className: 'text-2xl' }, 'üìà'),
                h('div', null,
                  h('div', { className: 'text-sm opacity-90' }, 'New Safe-to-Spend'),
                  h('div', { className: 'text-4xl font-bold' }, `$${fmt(newClear)}`)
                )
              ),

              h('div', { className: 'bg-white bg-opacity-20 rounded-lg p-4 text-base font-semibold' },
                'üéØ You found ',
                h('span', { className: 'text-xl' }, `$${fmt(improve)}`),
                ' of breathing room per month',
                h('div', { className: 'text-sm mt-2 opacity-90' }, `That's $${fmt(improve * 12)} per year`)
              ),

              commits.length > 0 ? h('div', { className: 'mt-4 bg-white bg-opacity-20 rounded-lg p-4' },
                h('div', { className: 'text-sm mb-2 flex items-center gap-2' }, '‚úÖ ', h('strong', null, 'You committed to try:')),
                h('ul', { className: 'm-0 pl-6 text-sm' },
                  commits.map((c) => h('li', { key: c, className: 'mb-1' },
                    c === 'subs' ? 'Cut subscriptions' :
                    c === 'eat' ? 'Reduce eating out' :
                    c === 'shop' ? 'Cut shopping' :
                    c === 'gas' ? 'Reduce transportation' :
                    c === 'ent' ? 'Cut entertainment' :
                    c === 'fees' ? 'Avoid fees' :
                    c === 'neg' ? 'Negotiate bills' :
                    c === 'side' ? 'Add side income' : c
                  ))
                )
              ) : null
            ) : null,

            h('button', {
              type: 'button',
              onClick: () => setStep(1),
              className: 'w-full p-4 bg-white hover:bg-gray-50 text-purple-600 border-2 border-purple-600 rounded-xl text-base font-bold'
            }, '‚Üê Back to Edit Numbers')
          ),

          h('div', { className: 'bg-white bg-opacity-15 backdrop-blur-lg rounded-lg p-4 text-white text-xs text-center flex items-center justify-center gap-2' },
            h('span', null, '‚ÑπÔ∏è'),
            h('span', null, 'This is educational only, not financial advice. Consult a professional for personalized guidance.')
          )
        )
      );
    }

    // Mount
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(h(App));
  </script>
</body>
</html>
